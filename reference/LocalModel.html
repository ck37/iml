<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>LocalModel — LocalModel • iml</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="LocalModel — LocalModel" />
<meta property="og:description" content="LocalModel fits locally weighted linear regression models (logistic
regression for classification) to explain single predictions of a prediction
model." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/intro.html">Introduction to iml: Interpretable Machine Learning in R</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel computation of interpretation methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/christophM/iml/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>LocalModel</h1>
    <small class="dont-index">Source: <a href='https://github.com/christophM/iml/blob/master/R/LocalModel.R'><code>R/LocalModel.R</code></a></small>
    <div class="hidden name"><code>LocalModel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>LocalModel</code> fits locally weighted linear regression models (logistic
regression for classification) to explain single predictions of a prediction
model.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A weighted glm is fitted with the machine learning model prediction as
target. Data points are weighted by their proximity to the instance to be
explained, using the gower proximity measure. L1-regularization is used to
make the results sparse.</p>
<p>The resulting model can be seen as a surrogate for the machine learning
model, which is only valid for that one point. Categorical features are
binarized, depending on the category of the instance to be explained: 1 if
the category is the same, 0 otherwise.</p>
<p>To learn more about local models, read the Interpretable Machine Learning
book: <a href='https://christophm.github.io/interpretable-ml-book/lime.html'>https://christophm.github.io/interpretable-ml-book/lime.html</a></p>
<p>The approach is similar to LIME, but has the following differences:</p><ul>
<li><p><strong>Distance measure</strong>: Uses as default the gower proximity (= 1 - gower
distance) instead of a kernel based on the Euclidean distance. Has the
advantage to have a meaningful neighborhood and no kernel width to tune.
When the distance is not <code>"gower"</code>, then the <code><a href='https://rdrr.io/r/stats/dist.html'>stats::dist()</a></code> function with the
chosen method will be used, and turned into a similarity measure:
\(sqrt(exp(-(distance^2) / (kernel.width^2)))\).</p></li>
<li><p><strong>Sampling</strong>: Uses the original data instead of sampling from normal
distributions. Has the advantage to follow the original data distribution.</p></li>
<li><p><strong>Visualization</strong>: Plots effects instead of betas. Both are the same for binary
features, but ared different for numerical features. For numerical features,
plotting the betas makes no sense, because a negative beta might still
increase the prediction when the feature value is also negative.</p></li>
</ul>

<p>To learn more about local surrogate models, read the Interpretable Machine
Learning book:
<a href='https://christophm.github.io/interpretable-ml-book/lime.html'>https://christophm.github.io/interpretable-ml-book/lime.html</a></p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ribeiro, M. T., Singh, S., &amp; Guestrin, C. (2016). "Why Should I Trust You?":
Explaining the Predictions of Any Classifier. Retrieved from
http://arxiv.org/abs/1602.04938</p>
<p>Gower, J. C. (1971), "A general coefficient of similarity and some of its
properties". Biometrics, 27, 623--637.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot.LocalModel.html'>plot.LocalModel</a></code> and <code><a href='predict.LocalModel.html'>predict.LocalModel</a></code></p>
<p><code><a href='Shapley.html'>Shapley</a></code> can also be used to explain single predictions</p>
<p>The package <code>lime</code> with the original implementation</p></div>
    <h2 class="hasAnchor" id="super-class"><a class="anchor" href="#super-class"></a>Super class</h2>

    <p><code><a href='InterpretationMethod.html'>iml::InterpretationMethod</a></code> -&gt; <code>LocalModel</code></p>
    <h2 class="hasAnchor" id="public-fields"><a class="anchor" href="#public-fields"></a>Public fields</h2>

    <p><div class="r6-fields"></p><dl'>
<dt><code>x.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Single row with the instance to be explained.</p></dd>

<dt><code>k</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
The number of features as set by the user.</p></dd>

<dt><code>model</code></dt><dd><p><code>glmnet</code><br />
The fitted local model.</p></dd>

<dt><code>best.fit.index</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
The index of the best glmnet fit.</p></dd>

</dl><p></div></p>
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
<h3>Public methods</h3>

<ul>
<li><p><a href='#method-new'><code>LocalModel$new()</code></a></p></li>
<li><p><a href='#method-predict'><code>LocalModel$predict()</code></a></p></li>
<li><p><a href='#method-explain'><code>LocalModel$explain()</code></a></p></li>
<li><p><a href='#method-clone'><code>LocalModel$clone()</code></a></p></li>
</ul>
<p><details open ><summary>Inherited methods</summary>
<ul>
<li><p><span class="pkg-link" data-pkg="iml" data-topic="InterpretationMethod" data-id="plot"><a href='../../iml/html/InterpretationMethod.html#method-plot'><code>iml::InterpretationMethod$plot()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="iml" data-topic="InterpretationMethod" data-id="print"><a href='../../iml/html/InterpretationMethod.html#method-print'><code>iml::InterpretationMethod$print()</code></a></span></p></li>
</ul>
</details>

<hr>
<a id="method-new"></a></p><h3>Method <code>new()</code></h3>
<p>Create a Local Model object.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>LocalModel</span>$<span class='fu'>new</span>(
  <span class='no'>predictor</span>,
  <span class='no'>x.interest</span>,
  <span class='kw'>dist.fun</span> <span class='kw'>=</span> <span class='st'>"gower"</span>,
  <span class='kw'>kernel.width</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>3</span>
)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>predictor</code></dt><dd><p><a href='Predictor.html'>Predictor</a><br />
The object (created with <code>Predictor$new()</code>) holding the machine
learning model and the data.</p></dd>

<dt><code>x.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Single row with the instance to be explained.</p></dd>

<dt><code>dist.fun</code></dt><dd><p><code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>)<br />
The name of the distance function for computing proximities (weights in
the linear model). Defaults to <code>"gower"</code>. Otherwise will be forwarded
to <a href='https://rdrr.io/r/stats/dist.html'>stats::dist</a>.</p></dd>

<dt><code>kernel.width</code></dt><dd><p>(<code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code>)<br />
The width of the kernel for the proximity computation.
Only used if dist.fun is not <code>"gower"</code>.</p></dd>

<dt><code>k</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
The number of features.</p></dd>

</dl><p></div></p>
<h3>Returns</h3>
<p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Results with the feature names (<code>feature</code>) and contributions to the
prediction.</p>
<p><hr>
<a id="method-predict"></a></p><h3>Method <code><a href='https://rdrr.io/r/stats/predict.html'>predict()</a></code></h3>
<p>Method to predict new data with the local model See also
<a href='predict.LocalModel.html'>predict.LocalModel</a>.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>LocalModel</span>$<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='kw'>newdata</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>newdata</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Data to predict on.</p></dd>

<dt><code>...</code></dt><dd><p>Not used</p></dd>

</dl><p></div></p>
<p><hr>
<a id="method-explain"></a></p><h3>Method <code>explain()</code></h3>
<p>Set a new data point to explain.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>LocalModel</span>$<span class='fu'>explain</span>(<span class='no'>x.interest</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>x.interest</code></dt><dd><p><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a><br />
Single row with the instance to be explained.</p></dd>

</dl><p></div></p>
<p><hr>
<a id="method-clone"></a></p><h3>Method <code>clone()</code></h3>
<p>The objects of this class are cloneable with this method.</p><h3>Usage</h3>
<p><div class="r"></p><pre><span class='no'>LocalModel</span>$<span class='fu'>clone</span>(<span class='kw'>deep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre><p></div></p>

<h3>Arguments</h3>
<p><div class="arguments"></p><dl'>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p></dd>

</dl><p></div></p>



    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"randomForest"</span>)
<span class='co'># First we fit a machine learning model on the Boston housing data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"Boston"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MASS"</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>Boston</span>[-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>Boston</span>) <span class='kw'>==</span> <span class='st'>"medv"</span>)]
<span class='no'>rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/randomForest/man/randomForest.html'>randomForest</a></span>(<span class='no'>medv</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>Boston</span>, <span class='kw'>ntree</span> <span class='kw'>=</span> <span class='fl'>50</span>)
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>rf</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>)

<span class='co'># Explain the first instance of the dataset with the LocalModel method:</span>
<span class='no'>x.interest</span> <span class='kw'>&lt;-</span> <span class='no'>X</span>[<span class='fl'>1</span>, ]
<span class='no'>lemon</span> <span class='kw'>&lt;-</span> <span class='no'>LocalModel</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>x.interest</span> <span class='kw'>=</span> <span class='no'>x.interest</span>, <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>2</span>)</div><div class='output co'>#&gt; <span class='message'>Loading required package: glmnet</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: Matrix</span></div><div class='output co'>#&gt; <span class='message'>Loaded glmnet 4.0</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: gower</span></div><div class='input'><span class='no'>lemon</span></div><div class='output co'>#&gt; Interpretation method:  LocalModel 
#&gt; 
#&gt; 
#&gt; Analysed predictor: 
#&gt; Prediction task: unknown 
#&gt; 
#&gt; 
#&gt; Analysed data:
#&gt; Sampling from data.frame with 506 rows and 13 columns.
#&gt; 
#&gt; Head of results:
#&gt;             beta x.recoded    effect x.original feature feature.value
#&gt; rm     2.9180763     6.575 19.186352      6.575      rm      rm=6.575
#&gt; lstat -0.3078282     4.980 -1.532985       4.98   lstat    lstat=4.98</div><div class='input'>
<span class='co'># Look at the results in a table</span>
<span class='no'>lemon</span>$<span class='no'>results</span></div><div class='output co'>#&gt;             beta x.recoded    effect x.original feature feature.value
#&gt; rm     2.9180763     6.575 19.186352      6.575      rm      rm=6.575
#&gt; lstat -0.3078282     4.980 -1.532985       4.98   lstat    lstat=4.98</div><div class='input'><span class='co'># Or as a plot</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>lemon</span>)</div><div class='img'><img src='LocalModel-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Reuse the object with a new instance to explain</span>
<span class='no'>lemon</span>$<span class='no'>x.interest</span></div><div class='output co'>#&gt;      crim zn indus chas   nox    rm  age  dis rad tax ptratio black lstat
#&gt; 1 0.00632 18  2.31    0 0.538 6.575 65.2 4.09   1 296    15.3 396.9  4.98</div><div class='input'><span class='no'>lemon</span>$<span class='fu'>explain</span>(<span class='no'>X</span>[<span class='fl'>2</span>, ])
<span class='no'>lemon</span>$<span class='no'>x.interest</span></div><div class='output co'>#&gt;      crim zn indus chas   nox    rm  age    dis rad tax ptratio black lstat
#&gt; 2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8 396.9  9.14</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>lemon</span>)</div><div class='img'><img src='LocalModel-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># LocalModel also works with multiclass classification</span>
<span class='no'>rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/randomForest/man/randomForest.html'>randomForest</a></span>(<span class='no'>Species</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>, <span class='kw'>ntree</span> <span class='kw'>=</span> <span class='fl'>50</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>[-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>iris</span>) <span class='kw'>==</span> <span class='st'>"Species"</span>)]
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='no'>Predictor</span>$<span class='fu'>new</span>(<span class='no'>rf</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"prob"</span>, <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"setosa"</span>)

<span class='co'># Then we explain the first instance of the dataset with the LocalModel method:</span>
<span class='no'>lemon</span> <span class='kw'>&lt;-</span> <span class='no'>LocalModel</span>$<span class='fu'>new</span>(<span class='no'>mod</span>, <span class='kw'>x.interest</span> <span class='kw'>=</span> <span class='no'>X</span>[<span class='fl'>1</span>, ], <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='no'>lemon</span>$<span class='no'>results</span></div><div class='output co'>#&gt;                    beta x.recoded     effect x.original      feature
#&gt; Sepal.Width   0.1780728       3.5  0.6232546        3.5  Sepal.Width
#&gt; Petal.Length -0.2158144       1.4 -0.3021402        1.4 Petal.Length
#&gt;                 feature.value
#&gt; Sepal.Width   Sepal.Width=3.5
#&gt; Petal.Length Petal.Length=1.4</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>lemon</span>)</div><div class='img'><img src='LocalModel-3.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christoph Molnar, <a href='https://pat-s.me'>Patrick Schratz</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


